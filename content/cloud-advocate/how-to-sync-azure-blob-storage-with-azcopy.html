<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何使用 AZCOPY 同步 Azure Blob 存储 | Azure 中文精选</title>
    <meta name="description" content="几个月前，我写了一篇关于如何使用 AzCopy 同步文件到 Azure Blob 存储的博客。今天针对我在 GitHub上使用 AzCopy 的一个问题，有了一个激动人心的更新。这意味着您现在可以使用 AzCopy 从 Azure Blog 到 Azure Blob。">
    <link rel="icon" href="/favicon.ico">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.44111ffa.css" as="style"><link rel="preload" href="/assets/js/app.6ff58d3f.js" as="script"><link rel="preload" href="/assets/js/2.5f974afc.js" as="script"><link rel="preload" href="/assets/js/17.efa5af3b.js" as="script"><link rel="preload" href="/assets/js/5.90cdf109.js" as="script"><link rel="prefetch" href="/assets/js/10.d4e6ccf5.js"><link rel="prefetch" href="/assets/js/11.2777b637.js"><link rel="prefetch" href="/assets/js/12.4a067d6a.js"><link rel="prefetch" href="/assets/js/13.174cb259.js"><link rel="prefetch" href="/assets/js/14.2bcf7b7f.js"><link rel="prefetch" href="/assets/js/15.855f1b8c.js"><link rel="prefetch" href="/assets/js/16.1df4917f.js"><link rel="prefetch" href="/assets/js/18.f89ce319.js"><link rel="prefetch" href="/assets/js/19.0648d848.js"><link rel="prefetch" href="/assets/js/20.593efa88.js"><link rel="prefetch" href="/assets/js/21.9937d326.js"><link rel="prefetch" href="/assets/js/22.ac939110.js"><link rel="prefetch" href="/assets/js/3.605daa86.js"><link rel="prefetch" href="/assets/js/4.17fe7f49.js"><link rel="prefetch" href="/assets/js/6.d9897289.js"><link rel="prefetch" href="/assets/js/7.31f97fee.js"><link rel="prefetch" href="/assets/js/8.09438130.js"><link rel="prefetch" href="/assets/js/9.d7c02753.js">
    <link rel="stylesheet" href="/assets/css/0.styles.44111ffa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo_azure.svg" alt="Azure 中文精选" class="logo"> <span class="site-name can-hide">Azure 中文精选</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/content/cloud-advocate/" class="nav-link router-link-active">Cloud Advocate</a></div><div class="nav-item"><a href="/content/tips-tricks/" class="nav-link">Tips &amp; Tricks</a></div><div class="nav-item"><a href="/tags.html" class="nav-link">标签</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我要参加翻译
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://azureselected.com/rss.xml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RSS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/azureselected/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/content/cloud-advocate/" class="nav-link router-link-active">Cloud Advocate</a></div><div class="nav-item"><a href="/content/tips-tricks/" class="nav-link">Tips &amp; Tricks</a></div><div class="nav-item"><a href="/tags.html" class="nav-link">标签</a></div><div class="nav-item"><a href="https://wj.qq.com/s2/5227985/7213/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我要参加翻译
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://azureselected.com/rss.xml" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RSS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/azureselected/azureselected" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何使用-azcopy-同步-azure-blob-存储"><a href="#如何使用-azcopy-同步-azure-blob-存储" class="header-anchor">#</a> 如何使用 AZCOPY 同步 Azure Blob 存储</h1> <blockquote><p>几个月前，我写了一篇关于 <a href="https://www.thomasmaurer.ch/2019/06/sync-folder-with-azure-blob-storage/" target="_blank" rel="noopener noreferrer">如何使用 AzCopy 同步文件到 Azure Blob 存储<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的博客。今天针对我在 <a href="https://github.com/Azure/azure-storage-azcopy/issues/116#issuecomment-554186120" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上使用 AzCopy 的一个问题，有了一个激动人心的更新。这意味着您现在可以使用 AzCopy 从 Azure Blog 到 Azure Blob。</p></blockquote> <blockquote><p>Azure Blob &lt;-&gt; Azure Blob (源必须包括共享访问令牌 SAS 或者可公共访问，对于目标可以支持共享访问令牌  SAS 或者 OAuth 认证)</p></blockquote> <h2 id="如何在-azure-blob-存储之间同步"><a href="#如何在-azure-blob-存储之间同步" class="header-anchor">#</a> 如何在 Azure Blob 存储之间同步</h2> <p>作为准备工作，您将需要 <code>安装并设置 AzCopy</code> ，或者在 <a href="https://www.thomasmaurer.ch/2019/01/azure-cloud-shell/" target="_blank" rel="noopener noreferrer">Azure Cloud Shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中使用 AzCopy.</p> <p>您可以使用下述命令将 Azure blob 存储同步到另外一个 Azure Blob 中。该命令将仅仅同步发生变化和新建的文件。其比较文件的名称和最后修改时间戳。</p> <div class="language- extra-class"><pre class="language-text"><code>azcopy sync &quot;https://[account].blob.core.windows.net/[container]/[path/to/blob]?[SAS]&quot; &quot;https://[account].blob.core.windows.net/[container]/[path/to/blob]?[SAS]&quot;
</code></pre></div><p>对于目标，你既可以使用 SAS 或者 OAuth。为了同步一个存储账号中的整个容器或者文件夹到另外一个账号，你可以使用下述命令：</p> <div class="language- extra-class"><pre class="language-text"><code>azcopy sync &quot;https://[account].blob.core.windows.net/[container]?[SAS]&quot; &quot;https://[account].blob.core.windows.net/[container]&quot;
</code></pre></div><p>作为示例，这里我将从在北欧区的 Azure 存储账号的一个容器中的文件，复制到西欧区的另一个存储账号中。</p> <p><img src="https://www.thomasmaurer.ch/wp-content/uploads/2019/11/Azure-Storage-Accounts-768x407.jpg" alt="Azure 存储帐户"></p> <p>我使用如下命令来实现：</p> <div class="language- extra-class"><pre class="language-text"><code>azcopy sync &quot;https://tomnortheurope.blob.core.windows.net/myfiles?[SAS]&quot; &quot;https://tomwesteurope.blob.core.windows.net/destinationfiles?[SAS]&quot; --recursive=true
</code></pre></div><p><img src="https://www.thomasmaurer.ch/wp-content/uploads/2019/11/Sync-Azure-Blob-Storage-with-AzCopy-768x390.jpg" alt="使用AzCopy同步Azure Blob存储"></p> <p>您可以看到，在第一次运行时，它确实将所有文件从源存储帐户复制到了目标位置。 在第二次运行中，它没有复制任何文件，因为文件已经存在了。</p> <p><img src="https://www.thomasmaurer.ch/wp-content/uploads/2019/11/Synced-Azure-Storage-Accounts-768x324.jpg" alt="已同步的Azure存储帐户"></p> <p>下面是一系列可以使用的参数。您可以在<a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-ref-azcopy-sync?WT.mc_id=thomasmaurer-blog-thmaure" target="_blank" rel="noopener noreferrer">微软 Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上发现更多的关于 <code>AzCopy sync</code> 的命令。</p> <p><strong>–block-size-mb</strong>  在上传到 Azure 存储或者从 Azure 存储下载时，使用的块尺寸 (以 MiB 为单位) 。默认基于文件尺寸自动计算。支持使用十进制小数(例如：0.25)。</p> <p><strong>–check-md5</strong> 字符串，指定在下载时，如何强制 MD5 散列值用于验证。该选项仅在下载时可用。可用值包括：NoCheck, LogOnly, FailIfDifferent, FailIfDifferentOrMissing. (默认值：‘FailIfDifferent’)。</p> <p><strong>–delete-destination</strong> 字符串。定义是否删除源中没有提供的目标中的其它文件。可以设置为： true, false, 或者 prompt。如果设置为 prompt，在删除文件或者 blob 之前，用户将被要求确认 (默认 false)。</p> <p><strong>–exclude-attributes</strong> 字符串（仅 Windows)，排除匹配文件属性的文件。例如：A;S;R</p> <p><strong>–exclude-pattern</strong> 字符串，排除匹配模板列表的文件，例如：.jpg;*.pdf;exactName</p> <p><strong>-h, –help</strong> 使用帮助</p> <p><strong>–include-attributes</strong> 字符串 (仅 Windows)，仅包含匹配文件属性列表的文件。例如： A;S;R</p> <p><strong>–include-pattern</strong> 字符串，仅包含匹配模板列表的文件。例如： <em>.jpg;</em>.pdf;exactName</p> <p><strong>–log-level</strong> 字符串， 定义日志文件的日志级别。可用的级别：INFO(所有的请求和响应)， WARNING(慢速响应)， ERROR(仅仅失败的请求)， 以及 NONE(没有输出日志). (默认 INFO). (default “INFO”)</p> <p><strong>–put-md5</strong> 对每个文件创建 MD5 散列，并保存将散列值作为目标 blob 或文件的 Content-MD5 属性。 (默认情况下，<strong>不</strong>创建散列)。仅在上传时可用。</p> <p><strong>–recursive</strong>  默认为 True，当在目录之间同步的时候，递归进入子目录 (默认为 true)。</p> <p>如果您希望了解更多关于同步本地文件到 Azure blob 存储的内容，请查看我的博客。我希望这可以帮助您快速查看如何使用 AzCopy 同步 Azure blob 存储。如果您希望学习更多内容，请查看微软 Docs 中关于如何  <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-ref-azcopy-sync?WT.mc_id=thomasmaurer-blog-thmaure" target="_blank" rel="noopener noreferrer">使用 AzCopy 传输数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果有任何问题，请留言。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azureselected/azureselected/edit/master/content/cloud-advocate/how-to-sync-azure-blob-storage-with-azcopy.md" target="_blank" rel="noopener noreferrer">在 GitHub 编辑本页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">12/31/2019, 2:45:26 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.6ff58d3f.js" defer></script><script src="/assets/js/2.5f974afc.js" defer></script><script src="/assets/js/17.efa5af3b.js" defer></script><script src="/assets/js/5.90cdf109.js" defer></script>
  </body>
</html>
